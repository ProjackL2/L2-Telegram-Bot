# Установка

Этот раздел поможет вам установить Hub (сервер Telegram-бота) и Agent (компонент на стороне игрового сервера).

### Предварительные требования

- Установленная Java 21 или новее в системном PATH (`java -version`).
- Сетевое соединение между хостом Hub и каждым хостом Agent (порты по умолчанию: Hub `1099`, Agent `1100`).
- Игровой сервер с рабочим скриптом интеграции, а именно `AgentScript.java`.

### Пакет Hub

- Скопируйте содержимое папки `hub/` на ваш целевой сервер.
- Важные файлы:
  - `l2tg-hub-1.0.jar` — исполняемый JAR-файл Hub.
  - `config/hub.properties` — конфигурация Hub.
  - `config/log.properties` — конфигурация логирования.
  - `start.bat` / `start.sh` — скрипты для удобного запуска.
- Отредактируйте `config/hub.properties` и установите как минимум:
  - `tg.username`, `tg.token`, `tg.admin_chat_ids` (получите эти значения в разделе [Создание Telegram-бота](bot-creation.md)).
  - `hub.host` (публичный или внутренний IP/имя хоста, доступное для Agents).
- Запустите Hub:
  - Windows: дважды щелкните по `start.bat` или запустите `start.bat` в консоли.
  - Linux/macOS: `chmod +x ./start.sh && ./start.sh`
  - Или запустите напрямую: `java -jar l2tg-hub-1.0.jar`

### Пакет Agent

- Скопируйте полученную папку из `temp/agent-<target>/` на машину с вашим игровым сервером.
- Важные файлы внутри пакета Agent:
  - `libs/l2tg-agent-1.0.jar` — бинарный файл Agent.
  - `game/config/agent.properties` — конфигурация Agent.
  - `game/data/scripts/services/AgentScript.java` — скрипт интеграции для вашего игрового сервера.
  - `game/data/...` — дополнительные данные/HTML, используемые ботом.
- Отредактируйте `game/config/agent.properties`:
  - Укажите в `hub.host`/`hub.port` адрес вашего экземпляра Hub.
  - Установите уникальный `server.id` и понятное `server.name`.
  - Убедитесь, что `rmi.auth.token` совпадает с Hub (если используется).
- Разместите `AgentScript.java` в скриптах вашего игрового сервера и перезагрузите скрипты согласно процедуре вашего сервера или перезагрузите сервер.

### Развертывание нескольких агентов

Если у вас более одного игрового сервера:

1. Повторите шаги «Пакет Agent» для каждого игрового сервера.
2. В файле `game/config/agent.properties` каждого агента назначьте **уникальный** `server.id` (например, `1`, `2`, `3`) и описательное имя `server.name`.
3. Если несколько агентов работают на **одной физической машине**, они должны использовать разные значения `agent.port` (например, `1100`, `1101` и т. д.), чтобы избежать конфликтов портов.

### Брандмауэр и сеть

- Откройте порт Hub `1099/tcp` на хосте Hub для входящих соединений от Agents.
- Откройте порт Agent `1100/tcp` на каждом хосте Agent для входящих соединений от Hub (для обратных вызовов RMI).
- Убедитесь, что значения `hub.host` и `agent.host` достижимы с противоположной стороны.

### Обновление

- Остановите процессы Hub/Agent.
- Замените JAR-файлы на новые версии.
- Проверьте и объедините изменения в конфигурационных файлах и файлах локализации.
- Снова запустите сервисы.
