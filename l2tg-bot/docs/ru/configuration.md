# Конфигурация

В этом разделе описаны все основные параметры как для Hub, так и для Agent. Предоставляются конфигурационные файлы по умолчанию, которые можно редактировать напрямую.

### Конфигурация Hub — `config/hub.properties`

```
# Имя пользователя бота (без символа @ в начале)
tg.username=

# Токен Telegram API, полученный от @BotFather
tg.token=

# Список ID чатов Telegram с правами администратора, разделенных запятыми.
# Пример: 123456789,987654321
tg.admin_chat_ids=

# Имя хоста/IP, который Hub будет объявлять для RMI. Должен быть доступен для Agents.
hub.host=127.0.0.1
hub.port=1099

# Общий секретный ключ. Если установлен на Hub, каждый Agent должен иметь такой же токен.
rmi.auth.token=

# Локализация
# Языковой код по умолчанию (см. раздел «Локализация»)
translation.default.lang=en
# Кэшировать ли локализованные сообщения в памяти (true/false)
translation.cache=true

# Лимиты Telegram и обработка событий
# Общее количество исходящих сообщений в секунду, разрешенное Hub.
tg.global.rate_limit=30
# Емкость внутренней очереди событий
event.queue.capacity=3000
# Размер пула потоков для отправки сообщений в Telegram
event.sender.pool_size=4
# Емкость очереди для пула отправителей
event.sender.queue.capacity=1000

# Соль для генерации кодов (не меняйте, если не знаете, что делаете)
code.salt=1420070400000

# Настройки базы данных (по умолчанию SQLite)
db.driver=org.sqlite.JDBC
db.url=jdbc:sqlite:config/hub.db
db.user=
db.password=
db.pool.max_size=10
```

Примечания:

- `tg.username`, `tg.token`, `tg.admin_chat_ids` можно получить, следуя разделу [Создание Telegram-бота](bot-creation.md).
- `hub.host` должен быть публичным или внутренним адресом, к которому могут подключиться Agents. Если Hub находится за NAT, настройте проброс портов и укажите корректный доступный адрес.
- `rmi.auth.token` должен быть одинаковым во всех экземплярах Hub и Agent.
- Если вы меняете `db.url`, убедитесь, что JDBC-драйвер соответствует базе данных и путь доступен для записи. По умолчанию SQLite устанавливается вместе с дистрибутивом.
- Лимит скорости (`rate_limit`) должен оставаться в рамках глобальных лимитов Telegram.

### Конфигурация Agent — `game/config/agent.properties`

```
# Идентификатор этого игрового сервера в реестре Hub
server.id=1
server.name=Server Name

# Адрес RMI-точки Hub (к которой подключаются Agents)
hub.host=127.0.0.1
hub.port=1099

# Адрес, который Agent объявляет для обратных вызовов от Hub
agent.host=127.0.0.1
agent.port=1100

# Должен совпадать с Hub, если установлен
rmi.auth.token=

# Опросы и «сердцебиение» (в миллисекундах)
ping.period=5000
events.period=250
```

Примечания:

- `server.id` должен быть уникальным среди всех агентов, подключенных к одному и тому же Hub. Это критически важно для системы, чтобы различать разные игровые серверы.
- `agent.host` должен быть доступен для Hub (при необходимости настройте NAT/проброс портов).
- Держите `rmi.auth.token` в секрете и используйте один и тот же токен на Hub и всех агентах.

### Конфигурация логирования — `config/log.properties`

- Управляет форматами и уровнями логирования. Вы можете повысить уровень детализации во время поиска неисправностей.
- Обычный способ повысить детализацию — переключить корневой пакет или конкретные пакеты на уровень `DEBUG`.

### Применение изменений конфигурации

- Для большинства настроек требуется перезапуск Hub/Agent, чтобы изменения вступили в силу.
- Полезная практика: делайте резервные копии оригинальных файлов перед редактированием и используйте систему контроля версий для отслеживания изменений.
